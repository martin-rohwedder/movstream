<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

    <secured attributes="hasRole('ROLE_ADMIN') or hasRole('ROLE_SUPERADMIN')" />
    
    <var name="genreObject" class="dk.movstream.web.domain.Genre" />
    
    <on-start>
        <evaluate expression="genreService.getAllMovieGenres()" result="flowScope.navGenres" />
        <evaluate expression="movieService.getMovieForm()" result="flowScope.movieForm" />
    </on-start>
    
    <!-- Create Movie Page 1 - Titel, Description and Genre -->
    <view-state id="createmovie1" view="createmovie1" model="flowScope.movieForm">
        <transition on="next" to="endOfFlow" />
        <transition on="newgenre" to="createmovie1-5" />
        <transition on="end" to="endOfFlow" />
    </view-state>
    
    <!-- Create Genre - Flow part of create movie, to create a new genre on the fly -->
    <view-state id="createmovie1-5" view="createmovie1-5" model="genreObject">
        <transition on="create" to="createmovie1">
            <evaluate expression="genreService.saveMovieGenre(genreObject)" />
            <evaluate expression="genreService.getAllMovieGenres()" result="flowScope.navGenres" />
        </transition>
        <transition on="back" to="createmovie1" />
    </view-state>
    
    <end-state id="endOfFlow" view="redirect:/admin/movie" />
    
</flow>
